// Typed error handling at a service boundary
minAdminAge = 18

loadUserForSession = id => do Effect {
  res <- attempt (api.fetchUser id)
  res match
    | Ok user                => pure user
    | Err NotFound           => fail SessionUserMissing
    | Err (Unauthorized _)   => fail SessionExpired
    | Err (NetworkTimeout _) => fail RetryLater
    | Err _                  => fail UpstreamUnavailable
}

validatedUser = do Effect {
  u <- loadUserForSession 123
  if u.age >= minAdminAge then pure (toAdmin u) else fail TooYoung
}
