{"version":3,"file":"aivi-server-html-client.js","sources":["../src/client.ts"],"sourcesContent":["/* eslint-disable */\n\nimport type { Boot, ClientMsg, ServerMsg } from \"./protocol\";\n\nfunction getBoot(): Boot | null {\n  const el = document.getElementById(\"aivi-server-html-boot\");\n  if (!el) return null;\n  try {\n    return JSON.parse(el.textContent || \"{}\") as Boot;\n  } catch {\n    return null;\n  }\n}\n\nfunction resolveWsUrl(wsUrl: unknown): string | null {\n  if (typeof wsUrl !== \"string\" || !wsUrl) return null;\n  if (wsUrl.startsWith(\"ws://\") || wsUrl.startsWith(\"wss://\")) return wsUrl;\n  if (wsUrl.startsWith(\"/\")) {\n    const proto = location.protocol === \"https:\" ? \"wss://\" : \"ws://\";\n    return proto + location.host + wsUrl;\n  }\n  return wsUrl;\n}\n\nfunction closestWithAttr(el: unknown, attr: string): Element | null {\n  let cur: any = el;\n  while (cur && cur !== document.body) {\n    if (cur.getAttribute && cur.getAttribute(attr)) return cur as Element;\n    cur = cur.parentNode;\n  }\n  return null;\n}\n\nfunction start(): void {\n  const boot = getBoot();\n  if (!boot || !boot.viewId) return;\n\n  const viewId = String(boot.viewId);\n  const wsUrl = resolveWsUrl(boot.wsUrl ?? boot.wsPath ?? \"/ws\");\n  if (!wsUrl) return;\n\n  const socket = new WebSocket(wsUrl);\n\n  function send(obj: ClientMsg): void {\n    try {\n      socket.send(JSON.stringify(obj));\n    } catch {\n      // ignore\n    }\n  }\n\n  socket.addEventListener(\"open\", () => {\n    send({ t: \"hello\", viewId, url: String(location.href), online: !!navigator.onLine });\n  });\n\n  // Node cache for patch application.\n  const nodeCache = new Map<string, Element>(); // nodeId -> Element\n  function getNode(nodeId: string): Element | null {\n    const cached = nodeCache.get(nodeId);\n    if (cached) return cached;\n    const el = document.querySelector(`[data-aivi-node=\"${CSS.escape(nodeId)}\"]`);\n    if (el) nodeCache.set(nodeId, el);\n    return el;\n  }\n\n  function replaceOuterHtml(nodeId: string, html: unknown): void {\n    const node = getNode(nodeId);\n    if (!node) return;\n    const tpl = document.createElement(\"template\");\n    tpl.innerHTML = String(html || \"\");\n    const newEl = tpl.content.firstElementChild;\n    if (!newEl) return;\n    node.replaceWith(newEl);\n    nodeCache.clear();\n  }\n\n  function applyOp(op: any): void {\n    if (!op || typeof op.op !== \"string\") return;\n    if (op.op === \"replace\") return replaceOuterHtml(String(op.id || \"\"), op.html);\n    if (op.op === \"setText\") {\n      const n = getNode(String(op.id || \"\"));\n      if (!n) return;\n      n.textContent = String(op.text || \"\");\n      return;\n    }\n    if (op.op === \"setAttr\") {\n      const n = getNode(String(op.id || \"\"));\n      if (!n) return;\n      n.setAttribute(String(op.name || \"\"), String(op.value || \"\"));\n      return;\n    }\n    if (op.op === \"removeAttr\") {\n      const n = getNode(String(op.id || \"\"));\n      if (!n) return;\n      n.removeAttribute(String(op.name || \"\"));\n    }\n  }\n\n  // IntersectionObserver subscriptions keyed by `sid`.\n  type IntersectionState = { observer: IntersectionObserver; elementToTid: WeakMap<Element, number>; tidToNodeId: Map<number, string> };\n  const intersection = new Map<number, IntersectionState>();\n\n  function intersectionSubscribe(msg: any): void {\n    const sid = msg && msg.sid;\n    if (typeof sid !== \"number\") return;\n    const opts = (msg && msg.p) || {};\n    const targets = (msg && msg.targets) || [];\n\n    let state = intersection.get(sid);\n    if (!state) {\n      const elementToTid = new WeakMap<Element, number>();\n      const tidToNodeId = new Map<number, string>();\n      let pending: any[] = [];\n      let scheduled = false;\n\n      function flush() {\n        scheduled = false;\n        if (!pending.length) return;\n        const entries = pending;\n        pending = [];\n        send({ t: \"platform\", viewId, kind: \"intersection\", p: { sid, entries } });\n      }\n\n      const observer = new IntersectionObserver(\n        (entries) => {\n          for (const e of entries) {\n            const tid = elementToTid.get(e.target);\n            if (typeof tid !== \"number\") continue;\n            pending.push({\n              tid,\n              isIntersecting: !!e.isIntersecting,\n              ratio: typeof e.intersectionRatio === \"number\" ? e.intersectionRatio : 0\n            });\n          }\n          if (!scheduled) {\n            scheduled = true;\n            Promise.resolve().then(flush);\n          }\n        },\n        {\n          root: null,\n          rootMargin: typeof opts.rootMargin === \"string\" ? opts.rootMargin : \"0px\",\n          threshold: Array.isArray(opts.threshold) ? opts.threshold : [0]\n        }\n      );\n\n      state = { observer, elementToTid, tidToNodeId };\n      intersection.set(sid, state);\n    }\n\n    for (const t of targets) {\n      if (!t) continue;\n      const tid = t.tid;\n      const nodeId = t.nodeId;\n      if (typeof tid !== \"number\" || typeof nodeId !== \"string\") continue;\n      const el = getNode(nodeId);\n      state.tidToNodeId.set(tid, nodeId);\n      if (!el) continue;\n      state.elementToTid.set(el, tid);\n      state.observer.observe(el);\n    }\n  }\n\n  function intersectionUnsubscribe(msg: any): void {\n    const sid = msg && msg.sid;\n    if (typeof sid !== \"number\") return;\n    const state = intersection.get(sid);\n    if (!state) return;\n    try {\n      state.observer.disconnect();\n    } catch {\n      // ignore\n    }\n    intersection.delete(sid);\n  }\n\n  function handleEffect(msg: any): void {\n    if (!msg || typeof msg.kind !== \"string\" || typeof msg.rid !== \"number\") return;\n    const rid = msg.rid;\n\n    if (msg.kind === \"clipboard.readText\") {\n      if (!navigator.clipboard || !navigator.clipboard.readText) {\n        return send({ t: \"effectResult\", viewId, rid, kind: msg.kind, ok: false, error: \"Unavailable\" });\n      }\n      navigator.clipboard\n        .readText()\n        .then((text) => {\n          send({ t: \"effectResult\", viewId, rid, kind: msg.kind, ok: true, p: { text: String(text) } });\n        })\n        .catch((err) => {\n          send({\n            t: \"effectResult\",\n            viewId,\n            rid,\n            kind: msg.kind,\n            ok: false,\n            error: String((err && (err as any).name) || \"Error\")\n          });\n        });\n      return;\n    }\n\n    if (msg.kind === \"clipboard.writeText\") {\n      if (!navigator.clipboard || !navigator.clipboard.writeText) {\n        return send({ t: \"effectResult\", viewId, rid, kind: msg.kind, ok: false, error: \"Unavailable\" });\n      }\n      const text2 = msg.p && typeof msg.p.text === \"string\" ? msg.p.text : \"\";\n      navigator.clipboard\n        .writeText(text2)\n        .then(() => {\n          send({ t: \"effectResult\", viewId, rid, kind: msg.kind, ok: true, p: {} });\n        })\n        .catch((err2) => {\n          send({\n            t: \"effectResult\",\n            viewId,\n            rid,\n            kind: msg.kind,\n            ok: false,\n            error: String((err2 && (err2 as any).name) || \"Error\")\n          });\n        });\n    }\n  }\n\n  socket.addEventListener(\"message\", (ev) => {\n    let msg: ServerMsg | null = null;\n    try {\n      msg = JSON.parse(String((ev as any).data)) as ServerMsg;\n    } catch {\n      return;\n    }\n    if (!msg || (msg as any).viewId !== viewId) return;\n\n    if (msg.t === \"patch\" && Array.isArray((msg as any).ops)) {\n      for (const op of (msg as any).ops) applyOp(op);\n      return;\n    }\n    if (msg.t === \"subscribe\" && (msg as any).kind === \"intersection\") return intersectionSubscribe(msg);\n    if (msg.t === \"unsubscribe\" && (msg as any).kind === \"intersection\") return intersectionUnsubscribe(msg);\n    if (msg.t === \"effect\") return handleEffect(msg);\n  });\n\n  function sendDomEvent(kind: string, ev: any): void {\n    const attr = `data-aivi-hid-${kind}`;\n    let target: any = ev && ev.target;\n    if (target && target.nodeType === 3) target = target.parentNode;\n    const el = closestWithAttr(target, attr);\n    if (!el) return;\n    const hid = parseInt(String(el.getAttribute(attr)), 10);\n    if (!isFinite(hid)) return;\n\n    let p: any = {};\n    if (kind === \"click\") {\n      p = { button: ev.button | 0, alt: !!ev.altKey, ctrl: !!ev.ctrlKey, shift: !!ev.shiftKey, meta: !!ev.metaKey };\n    } else if (kind === \"input\") {\n      let v = \"\";\n      try {\n        if (ev.target && \"value\" in ev.target) v = String(ev.target.value);\n      } catch {\n        // ignore\n      }\n      p = { value: v };\n    } else if (kind === \"keydown\" || kind === \"keyup\") {\n      p = {\n        key: String(ev.key || \"\"),\n        code: String(ev.code || \"\"),\n        alt: !!ev.altKey,\n        ctrl: !!ev.ctrlKey,\n        shift: !!ev.shiftKey,\n        meta: !!ev.metaKey,\n        repeat: !!ev.repeat,\n        isComposing: !!ev.isComposing\n      };\n    } else if (kind === \"pointerdown\" || kind === \"pointerup\" || kind === \"pointermove\") {\n      p = {\n        pointerId: ev.pointerId | 0,\n        pointerType: String(ev.pointerType || \"\"),\n        button: ev.button | 0,\n        buttons: ev.buttons | 0,\n        clientX: +ev.clientX || 0,\n        clientY: +ev.clientY || 0,\n        alt: !!ev.altKey,\n        ctrl: !!ev.ctrlKey,\n        shift: !!ev.shiftKey,\n        meta: !!ev.metaKey\n      };\n    }\n    send({ t: \"event\", viewId, hid, kind, p });\n  }\n\n  // Delegated DOM events. `focus`/`blur` require capture to reach the document listener.\n  document.addEventListener(\"click\", (ev) => sendDomEvent(\"click\", ev));\n  document.addEventListener(\"input\", (ev) => sendDomEvent(\"input\", ev));\n  document.addEventListener(\"keydown\", (ev) => sendDomEvent(\"keydown\", ev));\n  document.addEventListener(\"keyup\", (ev) => sendDomEvent(\"keyup\", ev));\n  document.addEventListener(\"pointerdown\", (ev) => sendDomEvent(\"pointerdown\", ev));\n  document.addEventListener(\"pointerup\", (ev) => sendDomEvent(\"pointerup\", ev));\n  document.addEventListener(\"pointermove\", (ev) => sendDomEvent(\"pointermove\", ev));\n  document.addEventListener(\n    \"focus\",\n    (ev) => {\n      sendDomEvent(\"focus\", ev);\n    },\n    true\n  );\n  document.addEventListener(\n    \"blur\",\n    (ev) => {\n      sendDomEvent(\"blur\", ev);\n    },\n    true\n  );\n\n  // Platform signals.\n  window.addEventListener(\"popstate\", () => {\n    send({\n      t: \"platform\",\n      viewId,\n      kind: \"popstate\",\n      p: { url: String(location.href), path: String(location.pathname), query: String(location.search), hash: String(location.hash) }\n    });\n  });\n  window.addEventListener(\"hashchange\", (ev: any) => {\n    send({\n      t: \"platform\",\n      viewId,\n      kind: \"hashchange\",\n      p: { url: String(location.href), oldURL: String(ev && ev.oldURL ? ev.oldURL : \"\"), newURL: String(ev && ev.newURL ? ev.newURL : \"\"), hash: String(location.hash) }\n    });\n  });\n  document.addEventListener(\"visibilitychange\", () => {\n    send({ t: \"platform\", viewId, kind: \"visibilitychange\", p: { visibilityState: String((document as any).visibilityState || \"\") } });\n  });\n  window.addEventListener(\"focus\", () => {\n    send({ t: \"platform\", viewId, kind: \"focus\", p: { focused: true } });\n  });\n  window.addEventListener(\"blur\", () => {\n    send({ t: \"platform\", viewId, kind: \"blur\", p: { focused: false } });\n  });\n  window.addEventListener(\"online\", () => {\n    send({ t: \"platform\", viewId, kind: \"online\", p: { online: true } });\n  });\n  window.addEventListener(\"offline\", () => {\n    send({ t: \"platform\", viewId, kind: \"online\", p: { online: false } });\n  });\n}\n\nstart();\n\n"],"names":["getBoot","el","resolveWsUrl","wsUrl","closestWithAttr","attr","cur","start","boot","viewId","socket","send","obj","nodeCache","getNode","nodeId","cached","replaceOuterHtml","html","node","tpl","newEl","applyOp","op","n","intersection","intersectionSubscribe","msg","sid","opts","targets","state","flush","scheduled","pending","entries","elementToTid","tidToNodeId","e","tid","t","intersectionUnsubscribe","handleEffect","rid","text","err","text2","err2","ev","sendDomEvent","kind","target","hid","p","v"],"mappings":"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"}