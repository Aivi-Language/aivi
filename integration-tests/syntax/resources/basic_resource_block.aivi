@no_prelude
module integrationTests.syntax.resources.basicResourceBlock

export managedFile

use aivi
use aivi.testing

managedFile : Text -> Resource Text FileHandle
managedFile = path => resource {
  handle <- file.open path
  yield handle
  _ <- file.close handle
}

@test
resourceOpenFailureIsCaught = effect {
  res <- attempt (load (file.readAll (managedFile "tmp/does-not-exist.resource")))
  _   <- res ?
    | Ok _  => assert False
    | Err _ => assert True
}
