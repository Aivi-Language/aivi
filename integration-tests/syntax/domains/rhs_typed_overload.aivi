@no_prelude
module integrationTests.syntax.domains.rhsTypedOverload

use aivi
use aivi.testing
use aivi.vector (vec4, transform4)
use aivi.matrix (identity4, multiply4)

// Test 1: Vec4 domain scalar scaling with *
@test "vec4 scalar mul"
vec4_scalar_mul = do Effect {
  v = vec4 1.0 2.0 3.0 1.0
  assertEq (v.x * 2.0) 2.0
  assertEq (v.y * 2.0) 4.0
  assertEq (v.z * 2.0) 6.0
  assertEq (v.w * 2.0) 2.0
}

// Test 2: Mat4 × Vec4 transform
@test "mat4 vec4 transform"
mat4_vec4_transform = do Effect {
  v = vec4 1.0 2.0 3.0 1.0
  result = transform4 identity4 v
  assertEq result.x 1.0
  assertEq result.y 2.0
  assertEq result.z 3.0
  assertEq result.w 1.0
}

// Test 3: Mat4 × Mat4 product
@test "mat4 mat4 product"
mat4_mat4_product = do Effect {
  m = multiply4 identity4 identity4
  assertEq m.m00 1.0
  assertEq m.m11 1.0
  assertEq m.m22 1.0
  assertEq m.m33 1.0
}

// Test 4: Vec4 arithmetic ops
@test "vec4 add"
vec4_add = do Effect {
  a = vec4 1.0 2.0 3.0 0.0
  b = vec4 4.0 5.0 6.0 1.0
  assertEq (a.x + b.x) 5.0
  assertEq (a.y + b.y) 7.0
  assertEq (a.z + b.z) 9.0
  assertEq (a.w + b.w) 1.0
}

// Test 5: Verify independent arithmetic semantics
@test "star vs cross are distinct"
star_vs_cross_are_distinct = do Effect {
  v = vec4 1.0 1.0 1.0 1.0
  scaled = 3.0 * 3.0
  transformed = transform4 identity4 v
  assertEq scaled 9.0
  assertEq transformed.x 1.0
}
