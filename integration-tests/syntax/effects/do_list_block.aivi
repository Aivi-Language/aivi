@no_prelude
module integrationTests.syntax.effects.doListBlock

use aivi
use aivi.testing

// Cartesian product: do List is equivalent to list comprehension
@test "do list cartesian"
doListCartesian = do Effect {
  result = do List {
    x <- [1, 2]
    y <- [10, 20]
    [x + y]
  }
  assertEq result [11, 21, 12, 22]
}

// Single bind
@test "do list single bind"
doListSingleBind = do Effect {
  result = do List {
    x <- [1, 2, 3]
    [x * 2]
  }
  assertEq result [2, 4, 6]
}

// Short-circuit on empty list
@test "do list empty short circuit"
doListEmptyShortCircuit = do Effect {
  result = do List {
    x <- [1, 2]
    y <- []
    [x + y]
  }
  assertEq result []
}

// Let-binding inside do List
@test "do list let binding"
doListLetBinding = do Effect {
  result = do List {
    x <- [1, 2, 3]
    y = x * 10
    [y]
  }
  assertEq result [10, 20, 30]
}

// Single expression block (identity)
@test "do list single expr"
doListSingleExpr = do Effect {
  result = do List {
    [42]
  }
  assertEq result [42]
}
