module examples.compiler.functions
export inc, add, compose, pipeline, getName, pairSum, twice, map, filter, sum, processed
use aivi.testing

inc = _ + 1
add = x y => x + y
compose = f g => x => f (g x)

pipeline = x => x |> inc |> (_ * 2)
getName = .name
pairSum = (a, b) => a + b

twice = f => x => f (f x)

map = f xs => xs ?
  | []        => []
  | [h, ...t] => [f h, ...map f t]

filter = p xs => xs ?
  | []                 => []
  | [h, ...t] when p h => [h, ...filter p t]
  | [_, ...t]          => filter p t

sum = xs => xs ?
  | []        => 0
  | [h, ...t] => h + sum t

processed = [1, 2, 3, 4, 5]
  |> map (add 10)
  |> filter (_ % 2 == 0)
  |> sum

__test_sentinel = 0

@test
smoke = effect {
  _ <- assert (inc 1 == 2)
  _ <- assert (add 2 3 == 5)
  _ <- assert (compose (_ + 1) (_ * 2) 3 == 7)
  _ <- assert (pipeline 2 == 6)
  _ <- assert (getName { name: "Ada" } == "Ada")
  _ <- assert (pairSum (2, 3) == 5)
  _ <- assert (twice (_ + 1) 0 == 2)
  _ <- assert (processed == 26)
}
