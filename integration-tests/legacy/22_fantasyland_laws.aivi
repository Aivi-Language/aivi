module examples.logic.fantasyland_laws
export main

use aivi.testing
use aivi.logic

id = x => x

compose = f g => x => g (f x)

incOpt = x => Some (x + 1)
incOk = x => Ok (x + 1)
inc = x => x + 1
triple = x => x * 3

main : Effect Text Unit
main = effect {
  // Option
  _ <- assertEq (map id (Some 1)) (Some 1)
  _ <- assertEq (map id None) None
  _ <- assertEq (map triple (map inc (Some 2))) (map (compose inc triple) (Some 2))
  _ <- assertEq (chain incOpt (Some 5)) (Some (5 + 1))
  _ <- assertEq (chain Some (Some 7)) (Some 7)

  // Result
  _ <- assertEq (map id (Ok 1)) (Ok 1)
  _ <- assertEq (map id (Err "e")) (Err "e")
  _ <- assertEq (map triple (map inc (Ok 2))) (map (compose inc triple) (Ok 2))
  _ <- assertEq (chain incOk (Ok 5)) (Ok (5 + 1))
  _ <- assertEq (chain Ok (Ok 7)) (Ok 7)
  _ <- assertEq (chain Ok (Err "e")) (Err "e")

  pure Unit
}

__test_sentinel = 0

@test
smoke = effect {
  _ <- assertEq (map id (Some 1)) (Some 1)
  _ <- assertEq (map id None) None
  _ <- assertEq (map triple (map inc (Some 2))) (map (compose inc triple) (Some 2))
  _ <- assertEq (chain incOpt (Some 5)) (Some 6)
  _ <- assertEq (chain Some (Some 7)) (Some 7)

  _ <- assertEq (map id (Ok 1)) (Ok 1)
  _ <- assertEq (map id (Err "e")) (Err "e")
  _ <- assertEq (map triple (map inc (Ok 2))) (map (compose inc triple) (Ok 2))
  _ <- assertEq (chain incOk (Ok 5)) (Ok 6)
  _ <- assertEq (chain Ok (Ok 7)) (Ok 7)
  _ <- assertEq (chain Ok (Err "e")) (Err "e")
}
