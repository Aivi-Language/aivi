module examples.stdlib_collections
export main

use aivi.console
use aivi
use aivi.testing

main : Effect Text Unit
main = effect {
  base = ~map{
    "a" => 1
    "b" => 2
  }
  more = ~map{
    "b" => 3
    "c" => 4
  }
  merged = Map.union base more
  print "merged: {merged}"

  tags = ~set["hot", "new", ...Set.fromList["fresh"]]
  print "tags: {tags}"

  q1 = Queue.enqueue "first" Queue.empty
  q2 = Queue.enqueue "second" q1
  popped = Queue.dequeue q2
  popped ?
    | Some (value, _) => print "queue: {value}"
    | None            => print "queue empty"

    d1 = Deque.pushFront 1 Deque.empty
    d2 = Deque.pushBack 2 d1
    d3 = Deque.pushBack 3 d2
    front = Deque.popFront d3
    front ?
      | Some (value, _) => print "deque: {value}"
      | None            => print "deque empty"

    h1 = Heap.push 3 Heap.empty
    h2 = Heap.push 1 h1
    h3 = Heap.push 2 h2
    smallest = Heap.popMin h3
    smallest ?
      | Some (value, _) => print "heap: {value}"
      | None            => print "heap empty"
}

__test_sentinel = 0

@test
smoke = effect {
  base = ~map{ "a" => 1, "b" => 2 }
  more = ~map{ "b" => 3, "c" => 4 }
  merged = Map.union base more
  _ <- assert (Map.get merged "a" == Some 1)
  _ <- assert (Map.get merged "b" == Some 3)
  q = Queue.enqueue "x" Queue.empty
  _ <- assert (Queue.dequeue q == Some ("x", Queue.empty))
  h = Heap.push 3 (Heap.push 1 Heap.empty)
  _ <- assert ((Heap.popMin h) ? | Some (v, _) => v == 1 | None => False)
}
