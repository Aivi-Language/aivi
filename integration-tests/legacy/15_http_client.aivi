module examples.httpClient
export main

use aivi.net.https
use aivi.testing

main : Effect Text Unit
main = effect {
  result <- get ~u(https://example.com)
  message = result ?
    | Ok response => "Status {response.status}"
    | Err err     => "Error {err.message}"
    print "{message}\n"
}

__test_sentinel = 0

@test
smoke = effect {
  url = ~u(https://example.com/path?q=1)
  _ <- assert (url.protocol == "https")
  _ <- assert (url.host == "example.com")
  _ <- assert (url.path == "/path")
  src = get url
  _ <- pure src
}
