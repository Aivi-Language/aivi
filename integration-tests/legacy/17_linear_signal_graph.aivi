
module examples.stdlib_linear_signal_graph
export main

use aivi
use aivi.console
use aivi.linear_algebra
use aivi.signal
use aivi.graph
use aivi.testing


main : Effect Text Unit
main = effect {
  v1 = { size: 3, data: [1.0, 2.0, 3.0] }
  v2 = { size: 3, data: [2.0, 0.0, 1.0] }
  d = dot v1 v2
  print "dot: {d}"

  m1 = { rows: 2, cols: 2, data: [1.0, 2.0, 3.0, 4.0] }
  m2 = { rows: 2, cols: 2, data: [2.0, 0.0, 1.0, 2.0] }
  m3 = matMul m1 m2
  print "matMul: {m3}"

  sig = { samples: [0.0, 1.0, 0.0, -1.0], rate: 4.0 }
  windowed = windowHann sig
  print "windowed: {windowed.samples}"

  g0 = {
    nodes: [1, 2, 3]
    edges: [
      { from: 1, to: 2, weight: 1.0 }
      { from: 2, to: 3, weight: 1.0 }
      { from: 1, to: 3, weight: 5.0 }
    ]
  }
  path = shortestPath g0 1 3
  print "path: {path}"
}

__test_sentinel = 0

@test
smoke = effect {
  v1 = { size: 3, data: [1.0, 2.0, 3.0] }
  v2 = { size: 3, data: [2.0, 0.0, 1.0] }
  d = dot v1 v2
  _ <- assert (abs (d - 5.0) < 0.0001)

  m1 = { rows: 2, cols: 2, data: [1.0, 2.0, 3.0, 4.0] }
  m2 = { rows: 2, cols: 2, data: [2.0, 0.0, 1.0, 2.0] }
  m3 = matMul m1 m2
  _ <- assert (m3.data == [4.0, 4.0, 10.0, 8.0])

  sig = { samples: [0.0, 1.0, 0.0, -1.0], rate: 4.0 }
  windowed = windowHann sig
  _ <- assert (length windowed.samples == 4)

  g0 = {
    nodes: [1, 2, 3]
    edges: [
      { from: 1, to: 2, weight: 1.0 }
      { from: 2, to: 3, weight: 1.0 }
      { from: 1, to: 3, weight: 5.0 }
    ]
  }
  path = shortestPath g0 1 3
  _ <- assertEq path (Some [1, 2, 3])
}
