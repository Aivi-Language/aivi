module examples.runtime
export main
use aivi.testing


main : Effect Text Unit
main = effect {
  _        <- concurrent.par (print "left\n") (print "right\n")
  (tx, rx) <- channel.make Unit
  prefix = "ping"
  channel.send tx "{prefix}\n"
  res <- channel.recv rx
  msg <- res ?
    | Ok text    => pure text
    | Err Closed => pure "closed\n"
    print msg
}

__test_sentinel = 0

@test
smoke = effect {
  (tx, rx) <- channel.make Text
  _ <- channel.send tx "ping"
  res <- channel.recv rx
  _ <- res ?
    | Ok msg  => assert (msg == "ping")
    | Err _   => assert False
}
