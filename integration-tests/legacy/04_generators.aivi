module examples.compiler.generators
export gen, evens, grid, fibs, pairs, squares
use aivi.testing
use aivi.generator


gen = generate {
  yield 1
  yield 2
  yield 3
}

evens = generate {
  x <- [1..10]
  x -> x % 2 == 0
  yield x
}

grid = generate {
  x <- [0..2]
  y <- [0..3]
  yield (x, y)
}

pairs = generate {
  x <- [1..5]
  y <- [1..5]
  y -> y > x
  yield { left: x, right: y, sum: x + y }
}

squares = generate {
  x <- [1..8]
  sq = x * x
  sq -> sq % 2 == 0
  yield sq
}

fibs = generate {
  x <- [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]
  yield x
}

__test_sentinel = 0

@test
smoke = effect {
  _ <- assert (generator.toList gen == [1, 2, 3])
  _ <- assert (generator.toList evens == [2, 4, 6, 8, 10])
  _ <- assert (generator.toList grid[0] == (0, 0))
  _ <- assert (length (generator.toList pairs) == 10)
  _ <- assert (generator.toList fibs[0] == 0)
}
