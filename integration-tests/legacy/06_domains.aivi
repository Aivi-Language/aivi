module examples.compiler.domains
export Date, Calendar, addWeek, addTwoWeeks, shiftBy
use aivi.testing


Date = { year: Int, month: Int, day: Int }

domain Calendar over Date = {
  Delta = Day Int | Week Int

  (+) : Date -> Delta -> Date
  (+) = d delta => delta ?
    | Day n  => addDays d n
    | Week n => addDays d (n * 7)

    d1 = Day 1
    w1 = Week 1

    addDays = d => n => d <| { day: (_ + n) }

    addWeek = d => d + w1

    addTwoWeeks = d => (d + w1) + w1

    shiftBy = d => delta => d + delta
}

__test_sentinel = 0

@test
smoke = effect {
  d = { year: 2024, month: 1, day: 1 }
  _ <- assert ((addWeek d).day == 8)
  _ <- assert ((addTwoWeeks d).day == 15)
  _ <- assert ((shiftBy d (Calendar.Day 3)).day == 4)
}
