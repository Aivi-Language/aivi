@no_prelude
module integrationTests.stdlib.aivi.logic.tests

use aivi
use aivi.prelude
use aivi.testing

// -- Setoid (equality) --

@test "setoid int"
setoid_int = do Effect {
  assert (1 == 1)
  assert (1 != 2)
}

@test "setoid text"
setoid_text = do Effect {
  assert ("hello" == "hello")
  assert ("hello" != "world")
}

// -- Ord (ordering) --

@test "ord int"
ord_int = do Effect {
  assert (1 < 2)
  assert (2 > 1)
  assert (1 <= 1)
  assert (1 >= 1)
}

// -- Functor --

// Note: map for Option/List should resolve via Functor typeclass (aivi.logic).
// Currently the builtin `map` handles List; Option is mapped manually until
// Functor instance resolution is wired end-to-end.

mapOption : (A -> B) -> Option A -> Option B
mapOption = f opt => opt match
  | Some x => Some (f x)
  | None   => None

@test "functor option"
functor_option = do Effect {
  some = Some 5
  mapped = mapOption (x => x + 1) some
  assertEq mapped (Some 6)

  noVal = None
  mappedNone = mapOption (x => x + 1) noVal
  assertEq mappedNone None
}

@test "functor list"
functor_list = do Effect {
  xs = [1, 2, 3]
  ys = each (x => x * 2) xs
  assertEq ys [2, 4, 6]
}
