@no_prelude
module integrationTests.stdlib.aivi.number.tests

use aivi
use aivi.testing
use aivi.number
use aivi.number.decimal as dec
use aivi.math

// -- BigInt --

@test "bigint from int"
bigint_fromInt = do Effect {
  b = fromInt 42
  assertEq (toInt b) (Some 42)
}

@test "bigint roundtrip"
bigint_roundtrip = do Effect {
  b = fromInt 0
  assertEq (toInt b) (Some 0)

  n = fromInt (-99)
  assertEq (toInt n) (Some (-99))
}

@test "bigint arithmetic"
bigint_arithmetic = do Effect {
  a = fromInt 10
  b = fromInt 20
  c = a + b
  assertEq (toInt c) (Some 30)
}

// -- Decimal --

@test "decimal from float"
decimal_fromFloat = do Effect {
  d = fromFloat 3.14
  f = toFloat d
  assert (abs (f - 3.14) < 0.01)
}

@test "decimal round"
decimal_round = do Effect {
  d = fromFloat 3.14159
  r = dec.round d 2
  f = toFloat r
  assert (abs (f - 3.14) < 0.01)
}

// -- Rational --

@test "rational construct"
rational_construct = do Effect {
  n = fromInt 2
  d = fromInt 4
  r = normalize n d
  assertEq (toInt (numerator r)) (Some 1)
  assertEq (toInt (denominator r)) (Some 2)
}
