@no_prelude
module integrationTests.stdlib.aivi.env.tests

use aivi
use aivi.testing
use aivi.system

@test "env get missing"
env_get_missing = do Effect {
  // Reading a nonexistent env var should return None
  val <- env.get "AIVI_TEST_NONEXISTENT_VAR_12345"
  val match
    | Some _ => assert False
    | None   => assert True
}

@test "env set and get"
env_set_and_get = do Effect {
  _ <- env.set "AIVI_TEST_KEY" "test_value"
  val <- env.get "AIVI_TEST_KEY"
  val match
    | Some v => assertEq v "test_value"
    | None   => assert False
}

@test "env remove"
env_remove = do Effect {
  _ <- env.set "AIVI_TEST_REMOVE" "to_remove"
  _ <- env.remove "AIVI_TEST_REMOVE"
  val <- env.get "AIVI_TEST_REMOVE"
  val match
    | Some _ => assert False
    | None   => assert True
}
