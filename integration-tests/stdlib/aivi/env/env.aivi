@no_prelude
module integrationTests.stdlib.aivi.env.tests

use aivi
use aivi.testing
use aivi.system

@test "env get missing"
env_get_missing = do Effect {
  // Reading a nonexistent env var should fail
  result <- attempt (env.get "AIVI_TEST_NONEXISTENT_VAR_12345")
  result match
    | Ok _  => assert False
    | Err e => assert (!(e == ""))
}

@test "env set and get"
env_set_and_get = do Effect {
  _   <- env.set "AIVI_TEST_KEY" "test_value"
  val <- env.get "AIVI_TEST_KEY"
  assertEq val "test_value"
}

@test "env remove"
env_remove = do Effect {
  _      <- env.set "AIVI_TEST_REMOVE" "to_remove"
  _      <- env.remove "AIVI_TEST_REMOVE"
  result <- attempt (env.get "AIVI_TEST_REMOVE")
  result match
    | Ok _  => assert False
    | Err e => assert (!(e == ""))
}
