@no_prelude
module integrationTests.stdlib.aivi.vector.tests

use aivi
use aivi.testing
use aivi.math
use aivi.vector
use aivi.matrix

@test
vec2_constructor = do Effect {
  v = vec2 3.0 4.0
  assertEq v.x 3.0
  assertEq v.y 4.0
}

@test
vec3_constructor = do Effect {
  v = vec3 1.0 2.0 3.0
  assertEq v.x 1.0
  assertEq v.z 3.0
}

@test
vec2_record = do Effect {
  v = Vec2 { x: 3.0, y: 4.0 }
  assertEq v.x 3.0
  assertEq v.y 4.0
}

@test
vec2_magnitude = do Effect {
  v = vec2 3.0 4.0
  assert (abs (magnitude v - 5.0) < 0.0001)
}

@test
vec3_magnitude = do Effect {
  v = vec3 1.0 2.0 2.0
  assert (abs (magnitude v - 3.0) < 0.0001)
}

@test
vec2_dot = do Effect {
  v1 = vec2 1.0 0.0
  v2 = vec2 0.0 1.0
  assert (abs (dot v1 v2) < 0.0001)

  v3 = vec2 1.0 1.0
  assert (abs (dot v1 v3 - 1.0) < 0.0001)
}

@test
vec3_cross = do Effect {
  v1 = vec3 1.0 0.0 0.0
  v2 = vec3 0.0 1.0 0.0
  c = cross v1 v2
  assert (abs c.x < 0.0001)
  assert (abs c.y < 0.0001)
  assert (abs (c.z - 1.0) < 0.0001)
}

@test
vec2_normalize = do Effect {
  v = vec2 3.0 4.0
  n = normalize v
  assert (abs (n.x - 0.6) < 0.0001)
  assert (abs (n.y - 0.8) < 0.0001)
}

@test
vec2_arithmetic = do Effect {
  a = vec2 1.0 2.0
  b = vec2 3.0 4.0
  s = a + b
  assertEq s.x 4.0
  assertEq s.y 6.0
  d = b - a
  assertEq d.x 2.0
  assertEq d.y 2.0
}

@test
vec2_scalar_mul = do Effect {
  v = vec2 2.0 3.0
  r = v * 2.0
  assertEq r.x 4.0
  assertEq r.y 6.0
}

@test
vec2_negate = do Effect {
  v = vec2 1.0-2.0
  n = negate v
  assertEq n.x -1.0
  assertEq n.y 2.0
}

@test
vec2_lerp = do Effect {
  a = vec2 0.0 0.0
  b = vec2 10.0 10.0
  mid = lerp a b 0.5
  assert (abs (mid.x - 5.0) < 0.0001)
  assert (abs (mid.y - 5.0) < 0.0001)
}

@test
vec2_distance = do Effect {
  a = vec2 0.0 0.0
  b = vec2 3.0 4.0
  assert (abs (distance a b - 5.0) < 0.0001)
}

@test
vec4_smoke = do Effect {
  v = vec4 1.0 2.0 3.0 4.0
  assertEq v.w 4.0
}

@test
transform2_identity = do Effect {
  v = vec2 3.0 4.0
  result = transform2 identity2 v
  assert (abs (result.x - 3.0) < 0.0001)
  assert (abs (result.y - 4.0) < 0.0001)
}

@test
transform3_identity = do Effect {
  v = vec3 1.0 2.0 3.0
  result = transform3 identity3 v
  assert (abs (result.x - 1.0) < 0.0001)
  assert (abs (result.y - 2.0) < 0.0001)
  assert (abs (result.z - 3.0) < 0.0001)
}

@test
transform4_identity = do Effect {
  v = vec4 1.0 2.0 3.0 1.0
  result = transform4 identity4 v
  assert (abs (result.x - 1.0) < 0.0001)
  assert (abs (result.y - 2.0) < 0.0001)
  assert (abs (result.z - 3.0) < 0.0001)
}

@test
transformPoint3_identity = do Effect {
  p = vec3 5.0 6.0 7.0
  result = transformPoint3 identity4 p
  assert (abs (result.x - 5.0) < 0.0001)
  assert (abs (result.y - 6.0) < 0.0001)
  assert (abs (result.z - 7.0) < 0.0001)
}
