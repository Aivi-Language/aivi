@no_prelude
module integrationTests.stdlib.aivi.vector.tests

use aivi
use aivi.testing
use aivi.math
use aivi.vector

@test
vec2_smoke = effect {
  v = { x: 3.0, y: 4.0 }
  assert (abs (magnitude v - 5.0) < 0.0001)
  assert (dot v v == 25.0)
}

@test
vec3_smoke = effect {
  v = { x: 1.0, y: 2.0, z: 3.0 }
  assert (v.z == 3.0)
  assert (cross { x: 1.0, y: 0.0, z: 0.0 } { x: 0.0, y: 1.0, z: 0.0 } == { x: 0.0, y: 0.0, z: 1.0 })
}

@test
vec4_smoke = effect {
  v = { x: 1.0, y: 2.0, z: 3.0, w: 4.0 }
  assert (v.w == 4.0)
}

@test
cross_smoke = effect {
  v1 = { x: 1.0, y: 0.0, z: 0.0 }
  v2 = { x: 0.0, y: 1.0, z: 0.0 }
  c = cross v1 v2
  assert (abs c.x < 0.0001)
  assert (abs c.y < 0.0001)
  assert (abs (c.z - 1.0) < 0.0001)
}

@test
dot_smoke = effect {
  v1 = { x: 1.0, y: 0.0 }
  v2 = { x: 0.0, y: 1.0 }
  assert (abs (dot v1 v2) < 0.0001)

  v3 = { x: 1.0, y: 1.0 }
  assert (abs (dot v1 v3 - 1.0) < 0.0001)
}

@test
magnitude_smoke = effect {
  v = { x: 3.0, y: 4.0 }
  assert (abs (magnitude v - 5.0) < 0.0001)
}

@test
normalize_smoke = effect {
  v = { x: 3.0, y: 4.0 }
  n = normalize v
  assert (abs (n.x - 0.6) < 0.0001)
  assert (abs (n.y - 0.8) < 0.0001)
  assert (abs (magnitude n - 1.0) < 0.0001)
}
