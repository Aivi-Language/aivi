@no_prelude
module integrationTests.stdlib.aivi.signal.tests

use aivi
use aivi.testing
use aivi.signal

@test "signal construct"
signal_construct = do Effect {
  // A signal has samples and a sample rate
  s = { samples: [0.0, 1.0, 0.0, -1.0], rate: 44100.0 }
  assertEq (List.length s.samples) 4
  assert (s.rate == 44100.0)
}

@test "normalize"
normalize_functional = do Effect {
  s = { samples: [0.0, 2.0, -4.0, 1.0], rate: 44100.0 }
  n = normalize s
  assertEq n.rate s.rate
  assertEq (List.length n.samples) (List.length s.samples)
}

@test "fft ifft roundtrip shape"
fft_ifft_types = do Effect {
  s = { samples: [1.0, 0.0, 1.0, 0.0], rate: 44100.0 }
  spectrum = fft s
  reconstructed = ifft spectrum
  assertEq spectrum.rate s.rate
  assertEq reconstructed.rate s.rate
  assertEq (List.length reconstructed.samples) (List.length s.samples)
}
