@no_prelude
module integrationTests.stdlib.aivi.file.tests

use aivi
use aivi.testing
use aivi.file

@test "file stats types"
fileStats_types = do Effect {
  // Verify FileStats type is well-formed
  fileStats =
    {
      size: 1024
      created: 1700000000000
      modified: 1700000000000
      isFile: True
      isDirectory: False
    }
    assertEq fileStats.size 1024
    assert fileStats.isFile
    assert (fileStats.isDirectory == False)
}

@test "exists missing"
exists_missing = do Effect {
  res <- exists "/tmp/aivi_nonexistent_file_12345.txt"
  assert (res == False)
}

@test "write text read text roundtrip"
writeText_readText_roundtrip = do Effect {
  path = "/tmp/aivi_test_roundtrip.txt"
  _          <- writeText path "hello aivi"
  contentRes <- readText path
  contentRes match
    | Ok content => assertEq content "hello aivi"
    | Err _      => assert False
    _           <- delete path
    existsAfter <- exists path
    assertEq existsAfter False
}
