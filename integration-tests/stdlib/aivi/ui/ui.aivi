@no_prelude
module integrationTests.stdlib.aivi.ui.tests

use aivi
use aivi.testing
use aivi.ui

len = xs => xs match
  | []           => 0
  | [_, ...rest] => 1 + len rest

@test "render html"
renderHtml_functional = do Effect {
  node = vElement "p" [vAttr "data-x" "1"] [vText "hi"]
  html = renderHtml node
  assert (text.length html > 0)
}

@test "diff"
diff_functional = do Effect {
  old = vElement "p" [vAttr "data-x" "1"] [vText "hi"]
  neu = vElement "p" [vAttr "data-x" "2"] [vText "hi"]
  ops = diff old neu
  assert (len ops >= 0)
}

@test "render html event handlers"
renderHtml_eventHandlers = do Effect {
  node =
    vElement "button"
    [vOnClick 1
      vOnFocus 2
      vOnKeyDown (k => 3)
      vOnInputE (i => 4)
    ]
    [vText "hi"]
  html = renderHtml node
  assert (text.contains "data-aivi-hid-click" html)
  assert (text.contains "data-aivi-hid-focus" html)
  assert (text.contains "data-aivi-hid-keydown" html)
  assert (text.contains "data-aivi-hid-input" html)
}
