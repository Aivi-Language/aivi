@no_prelude
module integrationTests.stdlib.aivi.map.tests

use aivi
use aivi.testing

@test "map insert and get"
map_insertAndGet = do Effect {
  m = Map.insert "a" 1 Map.empty
  assert (Map.get "a" m == Some 1)
}

@test "map get or else"
map_getOrElse = do Effect {
  m = Map.insert "found" 7 Map.empty
  val = Map.getOrElse "found" 99 m
  assert (val == 7)
  missing = Map.getOrElse "missing" 99 m
  assert (missing == 99)
}

@test "map remove"
map_remove = do Effect {
  m = Map.insert "a" 1 Map.empty
  m2 = Map.remove "a" m
  val = Map.get "a" m2
  assert (val == None)
}

@test "map has"
map_has = do Effect {
  m = Map.insert "key" 10 Map.empty
  exists = Map.has "key" m
  assert exists
  missing = Map.has "nope" m
  assert (missing == False)
}

@test "map size"
map_size = do Effect {
  m = Map.insert "a" 1 (Map.insert "b" 2 Map.empty)
  s0 = Map.size Map.empty
  assert (s0 == 0)
  s2 = Map.size m
  assert (s2 == 2)
}
