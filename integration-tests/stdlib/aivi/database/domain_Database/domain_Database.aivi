@no_prelude
module integrationTests.stdlib.aivi.database.domain_Database.tests

use aivi
use aivi.testing
use aivi.database
use aivi.database (domain Database)

@test
literal_del_smoke = effect {
  User = { id: Int }
  users0 = table "users"[]
  users1 <- users0 + ins { id: 1 }
  users2 <- users1 + del (u => u.id == 1)
  rows   <- load users2
  _      <- assert (List.length rows == 0)
}

@test
literal_ins_smoke = effect {
  User = { id: Int }
  users0 = table "users"[]
  users1 <- users0 + ins { id: 1 }
  rows   <- load users1
  _      <- assert (List.length rows == 1)
}

@test
literal_upd_smoke = effect {
  User = { id: Int, name: Text }
  users0 = table "users"[]
  users1 <- users0 + ins { id: 1, name: "A" }
  users2 <- users1 + upd (u => u.id == 1) (u => u <| { name: "B" })
  rows   <- load users2
  _      <- rows ?
    | [u] => assertEq u.name "B"
    | _   => assert False
}
