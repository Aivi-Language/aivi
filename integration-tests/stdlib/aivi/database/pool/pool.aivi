@no_prelude
module integrationTests.stdlib.aivi.database.pool.tests

use aivi
use aivi.testing
use aivi.database.pool

@test "pool error construct"
poolError_construct = do Effect {
  e1 = Timeout
  e2 = Closed
  e3 = HealthFailed
  e4 = InvalidConfig "bad"
  assertEq e1 Timeout
  assertEq e2 Closed
  assertEq e3 HealthFailed
  e4 match
    | InvalidConfig msg => assertEq msg "bad"
    | _                 => assert False
}

@test "queue policy construct"
queuePolicy_construct = do Effect {
  q1 = Fifo
  q2 = Lifo
  assertEq q1 Fifo
  assertEq q2 Lifo
}

@test "pool stats type"
poolStats_type = do Effect {
  s = { size: 4, idle: 2, inUse: 2, waiters: 0, closed: False }
  assertEq s.size 4
  assertEq s.idle 2
  assert (s.closed == False)
}
