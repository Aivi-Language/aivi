@no_prelude
module integrationTests.stdlib.aivi.database.upd

use aivi
use aivi.testing
use aivi.database

@test
smoke = effect {
  User = { id: Int, name: Text }
  users0 = table "users"[]
  users1 <- applyDelta users0 (ins { id: 1, name: "Ada" })
  users2 <- applyDelta users1 (upd (u => u.id == 1) (u => u <| { name: "Bea" }))
  rows   <- load users2
  _      <- rows ?
    | [u] => assertEq u.name "Bea"
    | _   => assert False
}
