@no_prelude
module integrationTests.stdlib.aivi.color.tests

use aivi
use aivi.testing
use aivi.color
use aivi.math
use aivi.text

@test
hex_smoke = effect {
  rgb = { r: 255, g: 0, b: 0 }
  hex = toHex rgb
  _ <- assert (text.startsWith hex "#")
  _ <- assert (text.length hex == 7)
}

@test
hsl_smoke = effect {
  h = { h: 240.0, s: 0.5, l: 0.5 }
  _ <- assert (h.s == 0.5)
  rgb = toRgb h
  _ <- assert (rgb.b >= rgb.r)
}

@test
rgb_smoke = effect {
  rgb = { r: 10, g: 20, b: 30 }
  _ <- assert (rgb.g > rgb.r)
  _ <- assert (rgb.b > rgb.g)
}

@test
adjustHue_smoke = effect {
  rgb = { r: 255, g: 0, b: 0 }
  shifted = adjustHue rgb 120
  _ <- assert (shifted.g > 0 || shifted.b > 0)
}

@test
adjustLightness_smoke = effect {
  rgb = { r: 20, g: 40, b: 60 }
  lighter = adjustLightness rgb 10
  darker = adjustLightness rgb (-10)
  _ <- assert (lighter.r >= rgb.r)
  _ <- assert (darker.r <= rgb.r)
}

@test
adjustSaturation_smoke = effect {
  rgb = { r: 100, g: 100, b: 100 }
  more = adjustSaturation rgb 20
  less = adjustSaturation rgb (-20)
  _ <- assert (more.r >= rgb.r)
  _ <- assert (less.r <= rgb.r)
}

@test
negateDelta_smoke = effect {
  light = negateDelta (Lightness 5)
  sat = negateDelta (Saturation 10)
  hue = negateDelta (Hue 15)
  _ <- assert (light == Lightness (-5))
  _ <- assert (sat == Saturation (-10))
  _ <- assert (hue == Hue (-15))
}

@test
toHex_smoke = effect {
  rgb = { r: 255, g: 255, b: 255 }
  hex = toHex rgb
  _ <- assert (text.length hex == 7)
  _ <- assert (text.startsWith hex "#")
}

@test
toHsl_smoke = effect {
  rgb = { r: 100, g: 150, b: 200 }
  hsl = toHsl rgb
  recon = toRgb hsl
  _ <- assert (abs (recon.r - rgb.r) < 10)
  _ <- assert (abs (recon.g - rgb.g) < 10)
  _ <- assert (abs (recon.b - rgb.b) < 10)
}

@test
toRgb_smoke = effect {
  hsl = { h: 120.0, s: 0.5, l: 0.5 }
  rgb = toRgb hsl
  _ <- assert (rgb.g >= rgb.r)
  _ <- assert (rgb.b >= rgb.r)
}
