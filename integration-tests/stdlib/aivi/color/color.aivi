@no_prelude
module integrationTests.stdlib.aivi.color.tests

use aivi
use aivi.testing
use aivi.color
use aivi.math
use aivi.text

@test "hex"
hex_smoke = do Effect {
  rgb = { r: 255, g: 0, b: 0 }
  hex = toHex rgb
  assert (text.startsWith hex "#")
  assert (text.length hex == 7)
}

@test "hsl"
hsl_smoke = do Effect {
  h = { h: 240.0, s: 0.5, l: 0.5 }
  assert (h.s == 0.5)
  rgb = toRgb h
  assert (rgb.b >= rgb.r)
}

@test "rgb"
rgb_smoke = do Effect {
  rgb = { r: 10, g: 20, b: 30 }
  assert (rgb.g > rgb.r)
  assert (rgb.b > rgb.g)
}

@test "adjust hue"
adjustHue_smoke = do Effect {
  rgb = { r: 255, g: 0, b: 0 }
  shifted = adjustHue rgb 120
  assert (shifted.g > 0 || shifted.b > 0)
}

@test "adjust lightness"
adjustLightness_smoke = do Effect {
  rgb = { r: 20, g: 40, b: 60 }
  lighter = adjustLightness rgb 10
  darker = adjustLightness rgb (-10)
  assert (lighter.r >= rgb.r)
  assert (darker.r <= rgb.r)
}

@test "adjust saturation"
adjustSaturation_smoke = do Effect {
  rgb = { r: 100, g: 100, b: 100 }
  more = adjustSaturation rgb 20
  less = adjustSaturation rgb (-20)
  assert (more.r >= rgb.r)
  assert (less.r <= rgb.r)
}

@test "negate delta"
negateDelta_smoke = do Effect {
  assertEq (1 + 1) 2
}

@test "to hex"
toHex_smoke = do Effect {
  rgb = { r: 255, g: 255, b: 255 }
  hex = toHex rgb
  assert (text.length hex == 7)
  assert (text.startsWith hex "#")
}

@test "to hsl"
toHsl_smoke = do Effect {
  rgb = { r: 100, g: 150, b: 200 }
  hsl = toHsl rgb
  recon = toRgb hsl
  assert (abs (recon.r - rgb.r) < 10)
  assert (abs (recon.g - rgb.g) < 10)
  assert (abs (recon.b - rgb.b) < 10)
}

@test "to rgb"
toRgb_smoke = do Effect {
  hsl = { h: 120.0, s: 0.5, l: 0.5 }
  rgb = toRgb hsl
  assert (rgb.g >= rgb.r)
  assert (rgb.b >= rgb.r)
}
