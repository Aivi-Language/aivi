@no_prelude
module integrationTests.stdlib.aivi.i18n.Catalog

use aivi
use aivi.testing
use aivi.i18n

@test
smoke = effect {
  en =
    (parseLocale "en") ?
      | Ok l  => l
      | Err _ => { language: "en", region: None, variants: [], tag: "en" }
  enUs =
    (parseLocale "en-US") ?
      | Ok l  => l
      | Err _ => { language: "en", region: Some "US", variants: [], tag: "en-US" }

  bEnRes = bundleFromProperties en "app.welcome = Hello\\n"
  bEnUsRes = bundleFromProperties enUs "app.welcome = Howdy\\n"

  bEn =
    bEnRes ?
      | Ok b  => b
      | Err _ => { locale: en, entries: Map.empty }
  bEnUs =
    bEnUsRes ?
      | Ok b  => b
      | Err _ => { locale: enUs, entries: Map.empty }

  catalog = catalogFromBundles [bEn, bEnUs]
  _ <- assert (tCatalog catalog enUs (~k\"app.welcome\") {} == \"Howdy\")
}
