@no_prelude
module integrationTests.stdlib.aivi.path.tests

use aivi
use aivi.testing
use aivi.path
use aivi.text

@test "parse absolute"
parse_absolute = do Effect {
  p = parse "/usr/local/bin"
  assert (isAbsolute p)
}

@test "parse relative"
parse_relative = do Effect {
  p = parse "src/main.aivi"
  assert (!(isAbsolute p))
}

@test "path segments"
path_segments = do Effect {
  p = parse "a/b/c"
  assert (List.length p.segments >= 1)
}

@test "file name"
fileName_functional = do Effect {
  p = parse "home/user/file.txt"
  fileName p match
    | Some name => assertEq name "file.txt"
    | None      => assert False
}

@test "parent"
parent_functional = do Effect {
  p = parse "a/b/c"
  parent p match
    | Some par => do Effect {
      fn = fileName par
      fn match
        | Some name => assertEq name "b"
        | None      => assert False
    }
    | None => assert False
}

@test "to string roundtrip"
  toString_roundtrip = do Effect {
    p = parse "a/b/c"
    s = toString p
    assert (text.length s > 0)
  }
