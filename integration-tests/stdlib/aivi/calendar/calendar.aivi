@no_prelude
module integrationTests.stdlib.aivi.calendar.tests

use aivi
use aivi.testing
use aivi.calendar

@test
date_smoke = effect {
  d = { year: 2024, month: 2, day: 29 }
  assert (d.year == 2024)
}

dateTime_touch : DateTime -> Unit
dateTime_touch = _ => Unit

@test
dateTime_smoke = effect {
  pure dateTime_touch
  assertEq (1 + 1) 2
}

endOfMonth_touch : EndOfMonth -> Unit
endOfMonth_touch = _ => Unit

@test
endOfMonth_smoke = effect {
  pure endOfMonth_touch
  assertEq (1 + 1) 2
}

@test
addDays_smoke = effect {
  d = addDays 1 { year: 2024, month: 2, day: 28 }
  assert (d.day == 29)
  assert (d.month == 2)

  d2 = addDays 2 { year: 2024, month: 2, day: 28 }
  assert (d2.day == 1)
  assert (d2.month == 3)
}

@test
addMonths_smoke = effect {
  d = addMonths 1 { year: 2024, month: 1, day: 31 }
  assert (d.month == 2)
  assert (d.day == 29) // 2024 is leap year, 29th is max
}

@test
addYears_smoke = effect {
  d = addYears 1 { year: 2024, month: 2, day: 29 }
  assert (d.year == 2025)
  assert (d.day == 28) // 2025 is not leap, clamps to 28
}

@test
daysInMonth_smoke = effect {
  assert (daysInMonth { year: 2024, month: 2, day: 1 } == 29)
  assert (daysInMonth { year: 2023, month: 2, day: 1 } == 28)
}

@test
endOfMonth_smoke_2 = effect {
  d = endOfMonth { year: 2024, month: 2, day: 1 }
  assert (d.day == 29)
}

@test
isLeapYear_smoke = effect {
  assert (isLeapYear { year: 2024, month: 1, day: 1 } == True)
  assert (isLeapYear { year: 2023, month: 1, day: 1 } == False)
}

@test
negateDelta_smoke = effect {
  pure negateDelta
  assert True
}

@test
now_smoke = effect {
  n <- now // todo make sure now is a function not an effect
  assert True // Just checking not crashing for now
}
