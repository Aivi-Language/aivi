@no_prelude
module integrationTests.stdlib.aivi.tree.Tree

use aivi
use aivi.testing
use aivi.tree

@test
traversals = effect {
  t = node 1 [leaf 2, node 3 [leaf 4, leaf 5], leaf 6]
  _ <- assertEq (dfsPreorder t)[1, 2, 3, 4, 5, 6]
  _ <- assertEq (dfsPostorder t)[2, 4, 5, 3, 6, 1]
  _ <- assertEq (bfs t)[1, 2, 3, 6, 4, 5]
}

@test
fromListByBuildsExpectedShape = effect {
  idFn = x => x
  parentIdFn = x =>
    if x == 1 then None
    else if x == 2 then Some 1
    else if x == 3 then Some 1
    else if x == 6 then Some 1
    else if x == 4 then Some 3
    else if x == 5 then Some 3
    else None

  t2 = (fromListBy idFn parentIdFn [1, 2, 3, 4, 5, 6]) ?
    | None   => leaf 0
    | Some t => t

    _ <- assertEq (dfsPreorder t2)[1, 2, 3, 4, 5, 6]
    _ <- assertEq (dfsPostorder t2)[2, 4, 5, 3, 6, 1]
    _ <- assertEq (bfs t2)[1, 2, 3, 6, 4, 5]
}

@test
fromListByRejectsMultipleRoots = effect {
  idFn = x => x
  parentIdFn = _ => None
  _ <- assertEq (fromListBy idFn parentIdFn [1, 2]) None
}
