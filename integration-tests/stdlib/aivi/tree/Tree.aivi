@no_prelude
module integrationTests.stdlib.aivi.tree.Tree

use aivi
use aivi.testing
use aivi.tree

len = xs => xs match
  | []           => 0
  | [_, ...rest] => 1 + len rest

@test
traversals = do Effect {
  t = node 1 [leaf 2, node 3 [leaf 4, leaf 5], leaf 6]
  assertEq (len (dfsPreorder t)) 6
  assertEq (len (dfsPostorder t)) 6
  assertEq (len (bfs t)) 6
}

@test
fromListByBuildsExpectedShape = do Effect {
  idFn = x => x
  parentIdFn = x =>
    if x == 1 then None
    else if x == 2 then Some 1
    else if x == 3 then Some 1
    else if x == 6 then Some 1
    else if x == 4 then Some 3
    else if x == 5 then Some 3
    else None

  t2 = (fromListBy idFn parentIdFn [1, 2, 3, 4, 5, 6]) match
    | None   => leaf 0
    | Some t => t

    assertEq (len (dfsPreorder t2)) 6
    assertEq (len (dfsPostorder t2)) 6
    assertEq (len (bfs t2)) 6
}

@test
fromListByRejectsMultipleRoots = do Effect {
  idFn = x => x
  parentIdFn = _ => None
  assertEq (fromListBy idFn parentIdFn [1, 2]) None
}
