@no_prelude
module integrationTests.stdlib.aivi.graph.tests

use aivi
use aivi.testing
use aivi.graph

@test "relax updates when shorter"
relax_updatesWhenShorter = do Effect {
  dists = Map.insert 1 0.0 Map.empty
  edge = { from: 1, to: 2, weight: 3.5 }
  out = relax dists 0.0 edge
  assert out.updated
  val = Map.get 2 out.dists
  assert (val == Some 3.5)
}

@test "relax skips when longer"
relax_skipsWhenLonger = do Effect {
  dists = Map.insert 1 0.0 (Map.insert 2 1.0 Map.empty)
  edge = { from: 1, to: 2, weight: 5.0 }
  out = relax dists 0.0 edge
  assert (out.updated == False)
  val = Map.get 2 out.dists
  assert (val == Some 1.0)
}

@test "relax edges counts updates"
relaxEdges_countsUpdates = do Effect {
  dists = Map.insert 0 0.0 Map.empty
  edges =
    [
      { from: 0, to: 1, weight: 2.0 }
      { from: 0, to: 2, weight: 5.0 }
      { from: 0, to: 3, weight: 1.0 }
    ]
  out = relaxEdges dists 0.0 edges
  assert (out.count == 3)
  d1 = Map.get 1 out.dists
  d2 = Map.get 2 out.dists
  d3 = Map.get 3 out.dists
  assert (d1 == Some 2.0)
  assert (d2 == Some 5.0)
  assert (d3 == Some 1.0)
}
