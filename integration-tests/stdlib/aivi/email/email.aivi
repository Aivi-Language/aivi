@no_prelude
module integrationTests.stdlib.aivi.email.tests

use aivi
use aivi.testing
use aivi.email

@test "mime parsing helpers"
mime_parsing_helpers = do Effect {
  raw = "Subject: hi\nContent-Type: text/plain\n\nhello"
  partsResult = mimeParts raw
  partsResult match
    | Ok parts => do Effect {
        assertEq (List.length parts >= 1) True
        combined = flattenBodies parts
        assert (text.contains "hello" combined)
      }
    | Err _ => assert False
}

@test "smtp surface"
smtp_surface = do Effect {
  _ <- attempt (smtpSend {
      host: "smtp.example.com"
      user: "u"
      password: "p"
      from: "from@example.com"
      to: "to@example.com"
      subject: "hello"
      body: "world"
  }
  )
  assert True
}
