@no_prelude
module integrationTests.stdlib.aivi.linalg.tests

use aivi
use aivi.testing
use aivi.linalg

@test
mat_smoke = effect {
  m = { rows: 2, cols: 2, data: [1.0, 0.0, 0.0, 1.0] }
  assert (m.rows == 2)
}

@test
vec_smoke = effect {
  v = { size: 3, data: [1.0, 2.0, 3.0] }
  assert (v.size == 3)
}

@test
dot_smoke = effect {
  v1 = { size: 2, data: [1.0, 2.0] }
  v2 = { size: 2, data: [3.0, 4.0] }
  d = dot v1 v2
  assert (d == 11.0)
}

@test
matMul_smoke = effect {
  m1 = { rows: 1, cols: 2, data: [1.0, 2.0] }
  m2 = { rows: 2, cols: 1, data: [3.0, 4.0] }
  m3 = matMul m1 m2
  assert (m3.rows == 1)
  assert (m3.cols == 1)
  assert (m3.data == [11.0])
}

@test
solve2x2_smoke = effect {
  // x + y = 3
  // x - y = 1
  // => x=2, y=1
  m = { rows: 2, cols: 2, data: [1.0, 1.0, 1.0, -1.0] }
  v = { size: 2, data: [3.0, 1.0] }
  res = solve2x2 m v
  assert (res.data == [2.0, 1.0])
}
