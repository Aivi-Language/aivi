@no_prelude
module integrationTests.stdlib.aivi.generator.tests

use aivi
use aivi.testing
use aivi.generator

len = xs => xs match
  | []           => 0
  | [_, ...rest] => 1 + len rest

@test
range_smoke = do Effect {
  xs = toList (range 0 5)
  assertEq (len xs) 5
  assertEq xs [0, 1, 2, 3, 4]
}

@test
range_empty = do Effect {
  xs = toList (range 5 5)
  assertEq xs []

  ys = toList (range 5 3)
  assertEq ys []
}

@test
fromList_toList = do Effect {
  g = fromList [10, 20, 30]
  xs = toList g
  assertEq xs [10, 20, 30]
}

@test
map_smoke = do Effect {
  g = range 1 4
  doubled = map (x => x * 2) g
  xs = toList doubled
  assertEq xs [2, 4, 6]
}

@test
filter_smoke = do Effect {
  g = range 1 6
  evens = filter (x => x % 2 == 0) g
  xs = toList evens
  assertEq xs [2, 4]
}

@test
foldl_sum = do Effect {
  g = range 1 4
  total = foldl (acc x => acc + x) 0 g
  assertEq total 6
}

@test
foldl_empty = do Effect {
  g = range 0 0
  total = foldl (acc x => acc + x) 42 g
  assertEq total 42
}
